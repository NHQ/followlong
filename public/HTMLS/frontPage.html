<!doctype html>
<html>
  <head>
    <title></title>
    <style>
    #channels{float:right;width:250px;};
    #channels li{};
    #console{width:1200px;float:left;};
    #container{width:900px;background:green;}
    #admin{};
    .hidden{display:none};
    .showin{display:inline-block};
    </style>
    <link type="text/css" rel="stylesheet" href="/stylesheets/style.css" />
  </head>
  
  <body>    
    <div id="admin"></div>
    <div id="console"></div>
    <div id="remote">
      <ul id="channels">
      </ul>
    </div>
    <a href="javascript:window.navigator.registerContentHandler('application/vnd.mozilla.maybe.feed',
                                      'http://mostmodernist.no.de/newFeed/?furl=%s',
                                      'Mmmm');">click</a>  
  </body>
  
  <script type='text/javascript', src='/javascripts/jquery-1.5.1.min.js'></script>
  <script type='text/javascript', src='/javascripts/jquery.isotope.min.js'></script>
  <script type='text/javascript', src='/javascripts/underscore.min.js'></script>
  <script type='text/javascript'>  
   if( typeof( window.innerWidth ) == 'number' ) {
      //Non-IE
      winx = window.innerWidth;
      winy = window.innerHeight;
    } else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {
      //IE 6+ in 'standards compliant mode'
      winx = document.documentElement.clientWidth;
      winy = document.documentElement.clientHeight;
    } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
      //IE 4 compatible
      winx = document.body.clientWidth;
      winy = document.body.clientHeight;
    };
  $('body').css({'width':winy,'height':winx});
  if (window.location.pathname === '/newFeed/')
    var newFeedChannels = [];
    $('#console').append('<h2>'+decodeURIComponent(window.location.search.slice(6))+'</h2><p>Click on a channel or multiple channels to add this feed to that channel, and/or create one or multiple channels by entering them into the field below and clicking "add". Click save when done.<p><ul id="newFeedChannels">Channels (Click to remove):</ul>');
    $('#remote ul#channels li.channel h1').live('click', function(event){
      event.preventDefault();
      var checker = _.detect(newFeedChannels, function (i){return i === $(this).html()}});
      console.log(checker);
      if (checker != undefined)
        {
          $('#console ul#newFeedChannels').append($(this).html());
          newFeedChannels.push($(this).html())
        }
    });
    
    /*{
      $.post('../followFeed?feed='+window.location.search.furl.slice(5), function(answer){
        if (answer === "1")
        {
          followFeed(window.location.hash.slice(1))
        }
      })
    }
    */
    function followfeed(feed){
       $('#container').empty();
        $('#container').load('/HTMLS/form.html');
    }
    
  /* var $container = $('ul#container');
   $container.isotope({
       itemSelector : 'li.articles',
   	  getSortData : {
   	    score : function ( $elem ) {
           return parseInt($elem.attr('data-score'));
         }
    	},
     layoutMode: 'fitRows',
     cellsByRow : {
       columnWidth : 800,
     	rowHeight: 100
     },
     animationOptions: {
       duration: 0,
       easing: 'none',
       queue: true
     },
     sortBy : 'score',
     sortAscending : false
   });
   */
   var channy = $.getJSON('/userChannels', function(channels){
     console.log(channels);
       for (c in channels)
     	    {
     	      var channel = '<li class="channel data-filter="'+channels[c]+'"><h1>'+channels[c]+'</h1></a></li>';$channeling = $(channel);$('ul#channels').append($channeling);
     	    }
    }).error(function(jqXHR, textStatus, errorThrown) { alert("error: "+errorThrown); });

/*  var feedMe = $.getJSON('/init', function (feeds){
    console.log(feeds);
    $.each(feeds, function (k, v){
      var obj = new Object();
      obj.feed = k;
      var chans = JSON.parse(v);
      var channels = function (chans){var chanz="";for(i = 0;i< chan.length;++i){chanz += ( chans[i]+" ")};return chanz};
      $.getJSON('/getfeed?feed='+encodeURIComponent(k), function (content){
        console.log(content);
        for (c in content)
        var item = '<li class="article" data-feedName="'+content[c][1]+'" data-score="'+content[c][2]+'" data-channels="'+channels+'"><h1>'+content[c][0]+'</h1></a></li>';$appending = $(item);$container.isotope('insert', $appending);
      }).error(function(jqXHR, textStatus, errorThrown) { alert("error: "+errorThrown); })
    })
  }).error(function(jqXHR, textStatus, errorThrown) { alert("error: "+errorThrown); });
*/
  function admin(){
    $('#container').empty();
    	    $('ul#channels li').css({'cursor':'pointer'});
    	    $('ul#channels li').click(function(event){
    	      event.preventDefault();
    	      var chan = $(this).attr('id');
    	      console.log(chan);
    	      infoChan(chan);
    	    })
  };
  function infoChan(chan){
    $.getJSON('/infoChan?chan='+chan, function(feeds){
       $('#container').empty();
      for (f in feeds)
      { 
        var food = '<a href="/" class="'+feeds[f][1]+'"><li>'+feeds[f][0]+'</li></a>';var $channeling = $(food);$('#container').append($channeling);
      }
      $('#container a').click(function(event){
        event.preventDefault();
        var feed = $(this).attr('class');
        infoFeed(feed);
      })
    });  
  };
  function infoFeed(feed){
    $.getJSON('/infoFeed?feed='+encodeURIComponent(feed), function (items){
      console.log(items);
      $('#container').empty();
      for (i = 0; i < items.length; i += 2)
      {
        var append = '<li class="articles" data-score="'+items[i+1]+'"><h2>"'+items[i]+'"</h2></li>';var $appending = $(append);$('#container').append($appending);
      }
    })
  };
  </script>
</html>
