<!doctype html>
<html>
  <head>
    <title></title>
    <style>
    .hidden{width:0};
    .subTitle{};
    </style>
  </head>
  <body>
  
  <h1 id="title"></h1>
  <h2 id="subTitle"></h2>
  <ul class="container"></ul>
  
  
  </body>
  <script type='text/javascript', src='https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js'></script>
  <script type='text/javascript', src='/javascripts/jquery.isotope.min.js'></script>
  <script type='text/javascript', src='/javascripts/path.min.js'></script>
   <script type='text/javascript'>
   $(document).ready(function(){
     if (window.location.hash)
     {
       $('#title').html('Choose Channel');
      $('#subTitle').html('or create a new subChannel');
     }
     else 
     {
       $('#title').html('Your Channels, Sir or Miss');
      $('#subTitle').html('You can create and delete channels and subChannels and sub sub channels');
     };
     var append = '';
     	 function neon (obj, x){
    	   if (typeof obj === 'string')
    	 {
    	   append += appendix(obj,x);
    	 } 
    	 else
    	 { 
    	   append += '<ul>';
    	   for (ect in obj)
    	  {   
    	    if (ect != 0)
    	    {z = x+'.'+ect;}
    	    else
    	    {z = x}
    	     neon(obj[ect], z)
    	   }
         append += '</ul>'
  	   }
     };
  	var hermes = $.getJSON('/info', function(data){
  	  y = data.length;
  	  append += '<form method="post", action="/new/channel"><input type="text" name="channel"><input type="hidden" name="station", value="'+y+'"><input type="submit" value="New subChannel"></form>'
  		for (x in data)
      {
        neon(data[x], x)
      }
       var $appending = $(append);
        $('ul.container').append($appending);
        $('ul.container').find('a.newSubTitle').bind('click', function(event){
          alert(event.target.nodeName)
        })

  	}).error(function(jqXHR, textStatus, errorThrown) { alert("error: "+errorThrown); });
  	 
  	 function appendix(obj, x){
       if (window.location.hash)
    	 {
    	   fURL = window.location.hash.slice(1);
    	   return '<li data-station="'+x+'"><form method="post", action="/follow/?furl='+fURL+'"><input type="hidden" name="channel", value="'+obj+'"><input type="submit" value="'+obj+'"></form><form method="post", action="/new/channel?furl='+fURL+'"><input type="text" name="channel"><input type="hidden" name="station", value="'+x+'"><input type="submit" value="+subChannel"></form></li>'
    	 }
  	   else 
  	   {
  	     return '<li data-station="'+x+'"><input type="button" value="'+obj+'"></input><form method="post", action="/delete/station"><input type="hidden" name="station", value="'+x+'"><input type="submit" value="delete"></form><form method="post", action="/new/channel"><input type="text" name="channel" class="hidden"><input type="hidden" name="station", value="'+x+'"><input type="submit" value="create this subChannel"><a href="#" class="newSubTitle">+ subChannel</a></form></li>'
  	  }
  	 }
  	 
  	 });
  </script>

</html>
